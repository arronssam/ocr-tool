
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>OCR 이미지 텍스트 추출기</title>
  <script src="https://unpkg.com/tesseract.js@v4.0.2/dist/tesseract.min.js"></script>
  <style>
    body {
      font-family: '맑은 고딕', sans-serif;
      padding: 20px;
      background: #f9f9f9;
    }
    #pasteArea {
      width: 100%;
      height: 300px;
      border: 2px dashed #aaa;
      display: none;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 20px;
      background: white;
      cursor: pointer;
    }
    #output {
      margin-top: 20px;
      font-size: 1.2rem;
      white-space: pre-wrap;
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #ddd;
      display: none;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
  <button id="startBtn">문제 스캔</button>
  <div id="pasteArea">이미지를 여기에 붙여넣기 (Ctrl + V)</div>
  <div id="output"></div>
  <script>
    const startBtn = document.getElementById('startBtn');
    const pasteArea = document.getElementById('pasteArea');
    const output = document.getElementById('output');

    function smartNormalizeAndClean(text) {
      let result = text.replace(/[①-⑳]|\(\d+\)|\d{1,2}[.,)]/g, '')
                       .replace(/\s+/g, '')
                       .replace(/([가-힣])([^가-힣\s])/g, '$1 $2')
                       .replace(/([^가-힣\s])([가-힣])/g, '$1 $2')
                       .replace(/([가-힣]{1})([A-Z])/g, '$1 $2');
      return result;
    }

    function basicCorrectionWithHighlight(text) {
      const rules = [
        { wrong: /되였/g, correct: '되었' },
        { wrong: /기법도입/g, correct: '기법 도입' },
        { wrong: /과정에대한강조/g, correct: '과정에 대한 강조' },
        { wrong: /마케팅활성화/g, correct: '마케팅 활성화' },
        { wrong: /즐시많은깃븐/g, correct: '옳지 않은 것' }
      ];
      let corrected = text;
      let found = false;
      rules.forEach(rule => {
        if (rule.wrong.test(corrected)) {
          found = true;
          corrected = corrected.replace(rule.wrong, '<mark>' + rule.correct + '</mark>');
        }
      });
      if (!found) {
        console.warn('⚠️ 감지된 오타 없음 (오타 검수)');
      }
      return corrected;
    }

    function resetState() {
      output.style.display = 'none';
      output.innerHTML = '';
      pasteArea.style.display = 'flex';
      startBtn.style.display = 'none';
    }

    startBtn.onclick = () => {
      pasteArea.style.display = 'flex';
      startBtn.style.display = 'none';
      pasteArea.focus();
    };

    pasteArea.addEventListener('paste', (event) => {
      const items = (event.clipboardData || event.originalEvent.clipboardData).items;
      for (let i = 0; i < items.length; i++) {
        if (items[i].type.indexOf("image") === 0) {
          const blob = items[i].getAsFile();
          const reader = new FileReader();
          reader.onload = function(e) {
            Tesseract.recognize(e.target.result, 'kor', {
              logger: m => console.log(m)
            }).then(({ data: { text } }) => {
              const cleaned = smartNormalizeAndClean(text);
              const corrected = basicCorrectionWithHighlight(cleaned);
              output.innerHTML = '<button onclick="resetState()">초기화</button><br><br>' + corrected;
              output.style.display = 'block';
              pasteArea.style.display = 'none';
            });
          };
          reader.readAsDataURL(blob);
        }
      }
    });
  </script>
</body>
</html>
